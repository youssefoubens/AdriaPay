<!-- src/app/componenents/beneficiary-component/beneficiary-component.html -->
<div class="beneficiary-wrapper">
  <!-- Navbar -->
  <app-navbar></app-navbar>

  <div class="beneficiary-container">
    <!-- Main Content -->
    <main class="beneficiary-main">
      <div class="content-wrapper">
        <!-- Page Header -->
        <div class="page-header">
          <div class="header-content">
            <h1 class="page-title">Beneficiaries</h1>
            <p class="page-subtitle">Manage your trusted recipients</p>
          </div>
          <button (click)="openAddModal()" class="btn btn-primary">
            <span class="material-symbols-outlined">person_add</span>
            <span class="btn-text">Add Beneficiary</span>
          </button>
        </div>

        <!-- Error Alert -->
        <div *ngIf="error" class="alert alert-error">
          <span class="material-symbols-outlined">error</span>
          <div class="alert-content">
            <p class="alert-title">Error</p>
            <p class="alert-message">{{ error }}</p>
          </div>
          <button class="alert-close" (click)="error = null">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>

        <!-- Search and Stats Bar -->
        <div class="search-stats-bar">
          <div class="search-container">
            <span class="material-symbols-outlined search-icon">search</span>
            <input
              [(ngModel)]="searchQuery"
              (input)="searchBeneficiaries()"
              type="text"
              placeholder="Search by name, RIB, or type..."
              class="search-input"
            />
            <button *ngIf="searchQuery" (click)="searchQuery = ''; searchBeneficiaries()" class="search-clear">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
          <div class="stats-badge">
            <span class="material-symbols-outlined">group</span>
            <span>{{ filteredBeneficiaries.length }} Total</span>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
          <div class="loading-spinner"></div>
          <p class="loading-text">Loading beneficiaries...</p>
        </div>

        <!-- Beneficiaries Content -->
        <div *ngIf="!loading">
          <!-- Desktop Table View -->
          <div class="beneficiaries-card desktop-view">
            <div class="table-container">
              <table class="beneficiaries-table">
                <thead>
                <tr>
                  <th>
                    <div class="th-content">
                      <span class="material-symbols-outlined">person</span>
                      Name
                    </div>
                  </th>
                  <th>
                    <div class="th-content">
                      <span class="material-symbols-outlined">account_balance</span>
                      RIB
                    </div>
                  </th>
                  <th>
                    <div class="th-content">
                      <span class="material-symbols-outlined">category</span>
                      Type
                    </div>
                  </th>
                  <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let beneficiary of filteredBeneficiaries" class="beneficiary-row">
                  <td>
                    <div class="beneficiary-info">
                      <div class="beneficiary-avatar">
                        {{ getInitial(beneficiary.firstName) }}
                      </div>
                      <div class="beneficiary-details">
                        <span class="beneficiary-name">{{ beneficiary.firstName }} {{ beneficiary.lastName }}</span>
                        <span class="beneficiary-id">ID: {{ beneficiary.id }}</span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="rib-container">
                      <span class="material-symbols-outlined rib-icon">credit_card</span>
                      <span class="rib-text">{{ maskRib(beneficiary.rib) }}</span>
                    </div>
                  </td>
                  <td>
                      <span [ngClass]="getTypeClass(beneficiary.type)" class="type-badge">
                        <span class="type-icon material-symbols-outlined">
                          {{ beneficiary.type === 'PHYSIQUE' ? 'person' : 'business' }}
                        </span>
                        {{ beneficiary.type === 'PHYSIQUE' ? 'Personal' : 'Business' }}
                      </span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <button (click)="openEditModal(beneficiary)" class="btn-action btn-action-edit" title="Edit">
                        <span class="material-symbols-outlined">edit</span>
                      </button>
                      <button (click)="deleteBeneficiary(beneficiary.id!)" class="btn-action btn-action-delete" title="Delete">
                        <span class="material-symbols-outlined">delete</span>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="filteredBeneficiaries.length === 0" class="empty-row">
                  <td colspan="4">
                    <div class="empty-state">
                      <div class="empty-icon">
                        <span class="material-symbols-outlined">group_off</span>
                      </div>
                      <h3 class="empty-title">
                        {{ searchQuery ? 'No beneficiaries found' : 'No beneficiaries yet' }}
                      </h3>
                      <p class="empty-description">
                        {{ searchQuery ? 'Try adjusting your search' : 'Add your first beneficiary to get started' }}
                      </p>
                      <button *ngIf="!searchQuery" (click)="openAddModal()" class="btn btn-primary">
                        <span class="material-symbols-outlined">add</span>
                        Add Beneficiary
                      </button>
                    </div>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Mobile Card View -->
          <div class="mobile-view">
            <div *ngFor="let beneficiary of filteredBeneficiaries" class="beneficiary-card-mobile">
              <div class="card-header">
                <div class="beneficiary-info">
                  <div class="beneficiary-avatar">
                    {{ getInitial(beneficiary.firstName) }}
                  </div>
                  <div class="beneficiary-details">
                    <span class="beneficiary-name">{{ beneficiary.firstName }} {{ beneficiary.lastName }}</span>
                    <span class="beneficiary-id">ID: {{ beneficiary.id }}</span>
                  </div>
                </div>
                <span [ngClass]="getTypeClass(beneficiary.type)" class="type-badge type-badge-small">
                  <span class="type-icon material-symbols-outlined">
                    {{ beneficiary.type === 'PHYSIQUE' ? 'person' : 'business' }}
                  </span>
                </span>
              </div>
              <div class="card-body">
                <div class="info-row">
                  <span class="info-label">RIB</span>
                  <span class="info-value">{{ maskRib(beneficiary.rib) }}</span>
                </div>
              </div>
              <div class="card-footer">
                <button (click)="openEditModal(beneficiary)" class="btn-mobile btn-mobile-edit">
                  <span class="material-symbols-outlined">edit</span>
                  Edit
                </button>
                <button (click)="deleteBeneficiary(beneficiary.id!)" class="btn-mobile btn-mobile-delete">
                  <span class="material-symbols-outlined">delete</span>
                  Delete
                </button>
              </div>
            </div>

            <div *ngIf="filteredBeneficiaries.length === 0" class="empty-state-mobile">
              <div class="empty-icon">
                <span class="material-symbols-outlined">group_off</span>
              </div>
              <h3 class="empty-title">
                {{ searchQuery ? 'No beneficiaries found' : 'No beneficiaries yet' }}
              </h3>
              <p class="empty-description">
                {{ searchQuery ? 'Try adjusting your search' : 'Add your first beneficiary to get started' }}
              </p>
              <button *ngIf="!searchQuery" (click)="openAddModal()" class="btn btn-primary">
                <span class="material-symbols-outlined">add</span>
                Add Beneficiary
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Floating Action Button -->
  <button [routerLink]="['/chatbot']" class="fab" title="Chat with support">
    <span class="material-symbols-outlined">support_agent</span>
  </button>

  <!-- Mobile FAB Add Button -->
  <button (click)="openAddModal()" class="fab-add mobile-only" title="Add beneficiary">
    <span class="material-symbols-outlined">add</span>
  </button>
</div>

<!-- Modal -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div>
        <h3 class="modal-title">{{ isEditMode ? 'Edit' : 'Add' }} Beneficiary</h3>
        <p class="modal-subtitle">{{ isEditMode ? 'Update beneficiary information' : 'Add a new trusted recipient' }}</p>
      </div>
      <button (click)="closeModal()" class="modal-close">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <form (ngSubmit)="saveBeneficiary()" class="modal-form">
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">
            <span class="material-symbols-outlined">person</span>
            First Name
          </label>
          <input
            [(ngModel)]="currentBeneficiary.firstName"
            name="firstName"
            required
            type="text"
            placeholder="Enter first name"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label class="form-label">
            <span class="material-symbols-outlined">person</span>
            Last Name
          </label>
          <input
            [(ngModel)]="currentBeneficiary.lastName"
            name="lastName"
            required
            type="text"
            placeholder="Enter last name"
            class="form-input"
          />
        </div>

        <div class="form-group form-group-full">
          <label class="form-label">
            <span class="material-symbols-outlined">credit_card</span>
            RIB (Bank Account Number)
          </label>
          <input
            [(ngModel)]="currentBeneficiary.rib"
            name="rib"
            required
            type="text"
            placeholder="Enter RIB number"
            class="form-input"
          />
        </div>

        <div class="form-group form-group-full">
          <label class="form-label">
            <span class="material-symbols-outlined">category</span>
            Account Type
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input
                type="radio"
                [(ngModel)]="currentBeneficiary.type"
                name="type"
                value="PHYSIQUE"
                class="radio-input"
              />
              <div class="radio-card">
                <span class="material-symbols-outlined">person</span>
                <div>
                  <span class="radio-title">Personal</span>
                  <span class="radio-description">Individual account</span>
                </div>
              </div>
            </label>
            <label class="radio-label">
              <input
                type="radio"
                [(ngModel)]="currentBeneficiary.type"
                name="type"
                value="MORALE"
                class="radio-input"
              />
              <div class="radio-card">
                <span class="material-symbols-outlined">business</span>
                <div>
                  <span class="radio-title">Business</span>
                  <span class="radio-description">Company account</span>
                </div>
              </div>
            </label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" (click)="closeModal()" class="btn btn-secondary">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">
          <span class="material-symbols-outlined">{{ isEditMode ? 'check' : 'add' }}</span>
          {{ isEditMode ? 'Update' : 'Create' }} Beneficiary
        </button>
      </div>
    </form>
  </div>
</div>
