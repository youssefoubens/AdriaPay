<!-- src/app/componenents/transfer-component/transfer-component.html -->
<div class="transfer-wrapper">
  <!-- Navbar -->
  <app-navbar></app-navbar>

  <div class="transfer-container">
    <!-- Main Content -->
    <main class="transfer-main">
      <div class="content-wrapper">
        <!-- Page Header -->
        <div class="page-header">
          <div class="header-content">
            <h1 class="page-title">Transfers</h1>
            <p class="page-subtitle">View and manage your transfer history</p>
          </div>
          <button (click)="openAddModal()" class="btn btn-primary">
            <span class="material-symbols-outlined">send</span>
            <span class="btn-text">New Transfer</span>
          </button>
        </div>

        <!-- Error Alert -->
        <div *ngIf="error" class="alert alert-error">
          <span class="material-symbols-outlined">error</span>
          <div class="alert-content">
            <p class="alert-title">Error</p>
            <p class="alert-message">{{ error }}</p>
          </div>
          <button class="alert-close" (click)="error = null">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>

        <!-- Search and Stats Bar -->
        <div class="search-stats-bar">
          <div class="search-container">
            <span class="material-symbols-outlined search-icon">search</span>
            <input
              [(ngModel)]="searchQuery"
              (input)="searchTransfers()"
              type="text"
              placeholder="Search by beneficiary, amount, or description..."
              class="search-input"
            />
            <button *ngIf="searchQuery" (click)="searchQuery = ''; searchTransfers()" class="search-clear">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
          <div class="stats-badge">
            <span class="material-symbols-outlined">swap_horiz</span>
            <span>{{ filteredTransfers.length }} Transfers</span>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
          <div class="loading-spinner"></div>
          <p class="loading-text">Loading transfers...</p>
        </div>

        <!-- Transfers Content -->
        <div *ngIf="!loading">
          <!-- Desktop Table View -->
          <div class="transfers-card desktop-view">
            <div class="table-container">
              <table class="transfers-table">
                <thead>
                <tr>
                  <th>
                    <div class="th-content">
                      <span class="material-symbols-outlined">person</span>
                      Beneficiary
                    </div>
                  </th>
                  <th>
                    <div class="th-content">
                      <span class="material-symbols-outlined">account_balance</span>
                      Source RIB
                    </div>
                  </th>
                  <th>
                    <div class="th-content">
                      <span class="material-symbols-outlined">payments</span>
                      Amount
                    </div>
                  </th>
                  <th>
                    <div class="th-content">
                      <span class="material-symbols-outlined">calendar_today</span>
                      Date
                    </div>
                  </th>
                  <th>
                    <div class="th-content">
                      <span class="material-symbols-outlined">speed</span>
                      Type
                    </div>
                  </th>
                  <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let transfer of filteredTransfers" class="transfer-row">
                  <td>
                    <div class="beneficiary-info">
                      <div class="beneficiary-avatar">
                        {{ getInitial(transfer.beneficiaryName) }}
                      </div>
                      <div class="beneficiary-details">
                        <span class="beneficiary-name">{{ transfer.beneficiaryName || 'Unknown' }}</span>
                        <span class="transfer-description">{{ truncateText(transfer.description, 30) }}</span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="rib-container">
                      <span class="material-symbols-outlined rib-icon">credit_card</span>
                      <span class="rib-text">{{ maskRib(transfer.sourceRib) }}</span>
                    </div>
                  </td>
                  <td>
                    <span class="amount">{{ formatAmount(transfer.amount) }}</span>
                  </td>
                  <td>
                    <div class="date-info">
                      <span class="date-primary">{{ transfer.date | date:'MMM d, y' }}</span>
                      <span class="date-secondary">{{ transfer.date | date:'h:mm a' }}</span>
                    </div>
                  </td>
                  <td>
                      <span [ngClass]="getTypeClass(transfer.type)" class="type-badge">
                        <span class="type-icon material-symbols-outlined">
                          {{ transfer.type === 'INSTANTANE' ? 'bolt' : 'schedule' }}
                        </span>
                        {{ transfer.type === 'INSTANTANE' ? 'Instant' : 'Normal' }}
                      </span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <button (click)="openEditModal(transfer)" class="btn-action btn-action-edit" title="Edit">
                        <span class="material-symbols-outlined">edit</span>
                      </button>
                      <button (click)="deleteTransfer(transfer.id!)" class="btn-action btn-action-delete" title="Delete">
                        <span class="material-symbols-outlined">delete</span>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="filteredTransfers.length === 0" class="empty-row">
                  <td colspan="6">
                    <div class="empty-state">
                      <div class="empty-icon">
                        <span class="material-symbols-outlined">sync_alt</span>
                      </div>
                      <h3 class="empty-title">
                        {{ searchQuery ? 'No transfers found' : 'No transfers yet' }}
                      </h3>
                      <p class="empty-description">
                        {{ searchQuery ? 'Try adjusting your search' : 'Create your first transfer to get started' }}
                      </p>
                      <button *ngIf="!searchQuery" (click)="openAddModal()" class="btn btn-primary">
                        <span class="material-symbols-outlined">add</span>
                        New Transfer
                      </button>
                    </div>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Mobile Card View -->
          <div class="mobile-view">
            <div *ngFor="let transfer of filteredTransfers" class="transfer-card-mobile">
              <div class="card-header">
                <div class="beneficiary-info">
                  <div class="beneficiary-avatar">
                    {{ getInitial(transfer.beneficiaryName) }}
                  </div>
                  <div class="beneficiary-details">
                    <span class="beneficiary-name">{{ transfer.beneficiaryName || 'Unknown' }}</span>
                    <span class="transfer-date">{{ transfer.date | date:'MMM d, y' }}</span>
                  </div>
                </div>
                <span class="amount amount-mobile">{{ formatAmount(transfer.amount) }}</span>
              </div>
              <div class="card-body">
                <div class="info-row">
                  <span class="info-label">Source RIB</span>
                  <span class="info-value">{{ maskRib(transfer.sourceRib) }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Description</span>
                  <span class="info-value">{{ transfer.description }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Type</span>
                  <span [ngClass]="getTypeClass(transfer.type)" class="type-badge type-badge-small">
                    <span class="type-icon material-symbols-outlined">
                      {{ transfer.type === 'INSTANTANE' ? 'bolt' : 'schedule' }}
                    </span>
                    {{ transfer.type === 'INSTANTANE' ? 'Instant' : 'Normal' }}
                  </span>
                </div>
              </div>
              <div class="card-footer">
                <button (click)="openEditModal(transfer)" class="btn-mobile btn-mobile-edit">
                  <span class="material-symbols-outlined">edit</span>
                  Edit
                </button>
                <button (click)="deleteTransfer(transfer.id!)" class="btn-mobile btn-mobile-delete">
                  <span class="material-symbols-outlined">delete</span>
                  Delete
                </button>
              </div>
            </div>

            <div *ngIf="filteredTransfers.length === 0" class="empty-state-mobile">
              <div class="empty-icon">
                <span class="material-symbols-outlined">sync_alt</span>
              </div>
              <h3 class="empty-title">
                {{ searchQuery ? 'No transfers found' : 'No transfers yet' }}
              </h3>
              <p class="empty-description">
                {{ searchQuery ? 'Try adjusting your search' : 'Create your first transfer to get started' }}
              </p>
              <button *ngIf="!searchQuery" (click)="openAddModal()" class="btn btn-primary">
                <span class="material-symbols-outlined">add</span>
                New Transfer
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Floating Action Button -->
  <button [routerLink]="['/chatbot']" class="fab" title="Chat with support">
    <span class="material-symbols-outlined">support_agent</span>
  </button>

  <!-- Mobile FAB Add Button -->
  <button (click)="openAddModal()" class="fab-add mobile-only" title="New transfer">
    <span class="material-symbols-outlined">add</span>
  </button>
</div>

<!-- Modal -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div>
        <h3 class="modal-title">{{ isEditMode ? 'Edit' : 'New' }} Transfer</h3>
        <p class="modal-subtitle">{{ isEditMode ? 'Update transfer details' : 'Send money to a beneficiary' }}</p>
      </div>
      <button (click)="closeModal()" class="modal-close">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <form (ngSubmit)="saveTransfer()" class="modal-form">
      <div class="form-grid">
        <div class="form-group form-group-full">
          <label class="form-label">
            <span class="material-symbols-outlined">person</span>
            Beneficiary
          </label>
          <select
            [(ngModel)]="currentTransfer.beneficiaryId"
            name="beneficiaryId"
            required
            class="form-select"
          >
            <option value="0" disabled>Select a beneficiary</option>
            <option *ngFor="let ben of beneficiaries" [value]="ben.id">
              {{ ben.firstName }} {{ ben.lastName }} ({{ maskRib(ben.rib) }})
            </option>
          </select>
        </div>

        <div class="form-group form-group-full">
          <label class="form-label">
            <span class="material-symbols-outlined">credit_card</span>
            Source RIB (Your Account)
          </label>
          <input
            [(ngModel)]="currentTransfer.sourceRib"
            name="sourceRib"
            required
            type="text"
            placeholder="Enter your account RIB"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label class="form-label">
            <span class="material-symbols-outlined">payments</span>
            Amount
          </label>
          <div class="input-with-icon">
            <span class="input-icon">€</span>
            <input
              [(ngModel)]="currentTransfer.amount"
              name="amount"
              required
              type="number"
              step="0.01"
              min="0.01"
              placeholder="0.00"
              class="form-input input-with-prefix"
            />
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span class="material-symbols-outlined">calendar_today</span>
            Transfer Date
          </label>
          <input
            [(ngModel)]="currentTransfer.date"
            name="date"
            required
            type="date"
            class="form-input"
          />
        </div>

        <div class="form-group form-group-full">
          <label class="form-label">
            <span class="material-symbols-outlined">description</span>
            Description
          </label>
          <textarea
            [(ngModel)]="currentTransfer.description"
            name="description"
            required
            rows="3"
            placeholder="What's this transfer for?"
            class="form-textarea"
          ></textarea>
        </div>

        <div class="form-group form-group-full">
          <label class="form-label">
            <span class="material-symbols-outlined">speed</span>
            Transfer Type
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input
                type="radio"
                [(ngModel)]="currentTransfer.type"
                name="type"
                value="NORMAL"
                class="radio-input"
              />
              <div class="radio-card">
                <span class="material-symbols-outlined">schedule</span>
                <div>
                  <span class="radio-title">Normal Transfer</span>
                  <span class="radio-description">1-2 business days</span>
                </div>
              </div>
            </label>
            <label class="radio-label">
              <input
                type="radio"
                [(ngModel)]="currentTransfer.type"
                name="type"
                value="INSTANTANE"
                class="radio-input"
              />
              <div class="radio-card">
                <span class="material-symbols-outlined">bolt</span>
                <div>
                  <span class="radio-title">Instant Transfer</span>
                  <span class="radio-description">Within seconds</span>
                </div>
              </div>
            </label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" (click)="closeModal()" class="btn btn-secondary">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">
          <span class="material-symbols-outlined">{{ isEditMode ? 'check' : 'send' }}</span>
          {{ isEditMode ? 'Update' : 'Send' }} Transfer
        </button>
      </div>
    </form>
  </div>
</div>
