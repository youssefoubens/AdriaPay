<!-- src/app/components/chatbot/chatbot.component.html -->
<div class="relative flex h-screen w-full flex-col bg-background-light dark:bg-background-dark">
  <div class="layout-container flex h-full grow flex-col">
    <div class="flex flex-1 justify-center">
      <div class="layout-content-container flex flex-col w-full max-w-5xl flex-1 bg-white dark:bg-background-dark shadow-lg">
        <!-- Header -->
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200 dark:border-gray-700 px-6 py-4">
          <div class="flex items-center gap-4 text-gray-800 dark:text-white">
            <span class="material-symbols-outlined text-primary text-3xl">account_balance</span>
            <h2 class="text-xl font-bold leading-tight tracking-[-0.015em]">Bank App</h2>
          </div>
          <div class="hidden md:flex items-center gap-8">
            <a [routerLink]="['/dashboard']" class="text-gray-800 dark:text-gray-300 text-sm font-medium leading-normal hover:text-primary">Home</a>
            <a [routerLink]="['/transfers']" class="text-gray-800 dark:text-gray-300 text-sm font-medium leading-normal hover:text-primary">Transfers</a>
            <a [routerLink]="['/beneficiaries']" class="text-gray-800 dark:text-gray-300 text-sm font-medium leading-normal hover:text-primary">Beneficiaries</a>
            <a [routerLink]="['/chatbot']" class="text-primary dark:text-primary text-sm font-bold leading-normal">Chatbot</a>
          </div>
          <div class="flex items-center gap-4">
            <button (click)="logout()" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/90 transition-colors">
              <span class="truncate">Logout</span>
            </button>
            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-gray-300"></div>
          </div>
        </header>

        <!-- Main Chat Area -->
        <main class="flex-1 flex flex-col overflow-hidden">
          <!-- Error Message -->
          <div *ngIf="error" class="mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800">
            {{ error }}
          </div>

          <!-- Messages Container -->
          <div #messagesContainer class="flex-1 p-6 overflow-y-auto space-y-6">
            <div *ngFor="let message of messages" [ngClass]="message.sender === 'user' ? 'flex items-end gap-3 p-4 justify-end' : 'flex items-end gap-3 p-4 max-w-lg'">
              <!-- Bot Avatar (left side) -->
              <div *ngIf="message.sender === 'bot'" class="bg-primary/20 bg-center bg-no-repeat aspect-square bg-cover rounded-full w-10 h-10 shrink-0 border-2 border-white dark:border-gray-700 flex items-center justify-center">
                <span class="material-symbols-outlined text-primary">smart_toy</span>
              </div>

              <!-- Message Content -->
              <div class="flex flex-1 flex-col gap-1" [ngClass]="message.sender === 'user' ? 'items-end' : 'items-start'">
                <p class="text-gray-500 dark:text-gray-400 text-xs font-normal leading-normal max-w-[360px]" [ngClass]="message.sender === 'user' ? 'text-right' : ''">
                  {{ message.sender === 'user' ? 'You' : 'Chatbot' }}
                </p>
                <div class="text-base font-normal leading-normal flex max-w-md rounded-lg px-4 py-3 shadow-sm"
                     [ngClass]="message.sender === 'user' ? 'rounded-br-none bg-primary text-white' : 'rounded-bl-none bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200'">
                  <p [innerHTML]="message.content"></p>
                </div>
              </div>

              <!-- User Avatar (right side) -->
              <div *ngIf="message.sender === 'user'" class="bg-gray-300 bg-center bg-no-repeat aspect-square bg-cover rounded-full w-10 h-10 shrink-0 border-2 border-white dark:border-gray-700 flex items-center justify-center">
                <span class="material-symbols-outlined text-gray-600">person</span>
              </div>
            </div>

            <!-- Typing Indicator -->
            <div *ngIf="isTyping" class="flex items-end gap-3 p-4 max-w-lg">
              <div class="bg-primary/20 bg-center bg-no-repeat aspect-square bg-cover rounded-full w-10 h-10 shrink-0 border-2 border-white dark:border-gray-700 flex items-center justify-center">
                <span class="material-symbols-outlined text-primary">smart_toy</span>
              </div>
              <div class="flex items-center gap-1.5">
                <div class="h-2 w-2 bg-primary rounded-full animate-pulse" style="animation-delay: -0.3s"></div>
                <div class="h-2 w-2 bg-primary rounded-full animate-pulse" style="animation-delay: -0.15s"></div>
                <div class="h-2 w-2 bg-primary rounded-full animate-pulse"></div>
              </div>
            </div>
          </div>

          <!-- Input Area -->
          <div class="border-t border-gray-200 dark:border-gray-700 p-4 bg-white dark:bg-background-dark">
            <div class="flex items-center gap-4">
              <div class="bg-gray-300 bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 shrink-0 flex items-center justify-center">
                <span class="material-symbols-outlined text-gray-600">person</span>
              </div>
              <label class="flex flex-col min-w-40 h-12 flex-1">
                <div class="flex w-full flex-1 items-stretch rounded-full h-full">
                  <input
                    [(ngModel)]="userMessage"
                    (keypress)="onKeyPress($event)"
                    [disabled]="isTyping"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-full text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/50 border-gray-300 dark:border-gray-600 bg-background-light dark:bg-gray-800 focus:border-primary h-full placeholder:text-gray-500 dark:placeholder:text-gray-400 px-5 text-base font-normal leading-normal"
                    placeholder="Type your message..."
                  />
                  <button
                    (click)="sendMessage()"
                    [disabled]="!userMessage.trim() || isTyping"
                    class="flex items-center justify-center -ml-12 z-10 size-10 rounded-full bg-primary text-white hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <span class="material-symbols-outlined text-2xl">send</span>
                  </button>
                </div>
              </label>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>
</div>
