<!-- src/app/componenents/chatbot-component/chatbot-component.html -->
<div class="chatbot-wrapper">
  <!-- Navbar -->
  <app-navbar></app-navbar>

  <div class="chatbot-container">
    <!-- Main Content -->
    <main class="chatbot-main">
      <div class="chat-layout">
        <!-- Chat Header -->
        <div class="chat-header">
          <div class="chat-header-content">
            <div class="bot-avatar-large">
              <span class="material-symbols-outlined">support_agent</span>
            </div>
            <div class="bot-info">
              <h1 class="bot-name">Banking Assistant</h1>
              <p class="bot-status">
                <span class="status-indicator"></span>
                Online • Ready to help
              </p>
            </div>
          </div>
          <div class="chat-header-actions">
            <button (click)="clearChat()" class="btn-icon" title="Clear chat">
              <span class="material-symbols-outlined">delete_sweep</span>
            </button>
          </div>
        </div>

        <!-- Error Alert -->
        <div *ngIf="error" class="alert alert-error">
          <span class="material-symbols-outlined">error</span>
          <div class="alert-content">
            <p class="alert-title">Error</p>
            <p class="alert-message">{{ error }}</p>
          </div>
          <button class="alert-close" (click)="error = null">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>

        <!-- Messages Container -->
        <div #messagesContainer class="messages-container">
          <!-- Welcome Message -->
          <div *ngIf="messages.length === 0" class="welcome-message">
            <div class="welcome-icon">
              <span class="material-symbols-outlined">waving_hand</span>
            </div>
            <h2 class="welcome-title">Welcome to Banking Assistant!</h2>
            <p class="welcome-description">I'm here to help you with your banking needs. Ask me about transfers, beneficiaries, or account information.</p>
            <div class="quick-actions">
              <button (click)="sendQuickMessage('How do I add a beneficiary?')" class="quick-action-btn">
                <span class="material-symbols-outlined">person_add</span>
                Add Beneficiary
              </button>
              <button (click)="sendQuickMessage('How do I make a transfer?')" class="quick-action-btn">
                <span class="material-symbols-outlined">send</span>
                Make Transfer
              </button>
              <button (click)="sendQuickMessage('Show my recent transactions')" class="quick-action-btn">
                <span class="material-symbols-outlined">history</span>
                View History
              </button>
            </div>
          </div>

          <!-- Chat Messages -->
          <div *ngFor="let message of messages; let i = index"
               class="message-wrapper"
               [ngClass]="message.sender === 'user' ? 'message-wrapper-user' : 'message-wrapper-bot'"
               [@messageAnimation]>

            <!-- Bot Message -->
            <div *ngIf="message.sender === 'bot'" class="message message-bot">
              <div class="message-avatar">
                <span class="material-symbols-outlined">support_agent</span>
              </div>
              <div class="message-content-wrapper">
                <div class="message-header">
                  <span class="message-sender">Banking Assistant</span>
                  <span class="message-time">{{ message.timestamp | date:'shortTime' }}</span>
                </div>
                <div class="message-bubble message-bubble-bot">
                  <div [innerHTML]="message.content"></div>
                </div>
              </div>
            </div>

            <!-- User Message -->
            <div *ngIf="message.sender === 'user'" class="message message-user">
              <div class="message-content-wrapper">
                <div class="message-header">
                  <span class="message-time">{{ message.timestamp | date:'shortTime' }}</span>
                  <span class="message-sender">You</span>
                </div>
                <div class="message-bubble message-bubble-user">
                  <p>{{ message.content }}</p>
                </div>
              </div>
              <div class="message-avatar message-avatar-user">
                <span class="material-symbols-outlined">person</span>
              </div>
            </div>
          </div>

          <!-- Typing Indicator -->
          <div *ngIf="isTyping" class="message-wrapper message-wrapper-bot" [@messageAnimation]>
            <div class="message message-bot">
              <div class="message-avatar">
                <span class="material-symbols-outlined">support_agent</span>
              </div>
              <div class="message-content-wrapper">
                <div class="message-header">
                  <span class="message-sender">Banking Assistant</span>
                </div>
                <div class="typing-indicator">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
          <div class="input-container">
            <button class="btn-attachment" title="Attach file" disabled>
              <span class="material-symbols-outlined">attach_file</span>
            </button>
            <input
              [(ngModel)]="userMessage"
              (keypress)="onKeyPress($event)"
              [disabled]="isTyping"
              type="text"
              placeholder="Type your message..."
              class="message-input"
            />
            <button
              (click)="sendMessage()"
              [disabled]="!userMessage.trim() || isTyping"
              class="btn-send"
              title="Send message">
              <span class="material-symbols-outlined">send</span>
            </button>
          </div>
          <p class="input-hint">Press Enter to send • Shift + Enter for new line</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Back to Dashboard FAB -->
  <button [routerLink]="['/dashboard']" class="fab" title="Back to dashboard">
    <span class="material-symbols-outlined">home</span>
  </button>
</div>
